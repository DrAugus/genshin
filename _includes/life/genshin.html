<script>
    //这样获取时 需要在对应的时间后面加上utc+8
    const eventsData = {{site.data.genshin.wish.characters | jsonify}}
</script>


<style>
    button:focus {
        outline: none;
        background-color: rgba(255, 255, 255, 0);
    }

    .slider .indicators .indicator-item {
        background: #fff url("/assets/res/genshin-impact/primogem.png") no-repeat;
        background-size: cover;
    }

    /*修改slider按钮颜色*/
    .slider .indicators .indicator-item.active {
        background: #fff url("/assets/res/genshin-impact/intertwined_fate.png") no-repeat;
        background-size: cover;
    }

</style>


<div class="col s12 center-align">
    <img src="/assets/res/genshin-impact/ys.png">
</div>

<!--长度减1-->
{% capture lenMonthList %}119{% endcapture %}
{% capture lenAllDays %}3649{% endcapture %}
<!--无法动态设置slider将该长度设置为5 其他填充为敬请期待-->
{% capture lenFuture %}4{% endcapture %}
{% capture lenCurrent %}99{% endcapture %}

{% capture lenElements %}6{% endcapture %}

<!--时间轴-->
<div class="col s12">
    <div class="timeline-scroll-x" id="setNowPos">

        <div class="timeline-month">
            {% for i in (0..lenMonthList) %}
            <div class="timeline-month-left-{{i}} hide">
                <div class="timeline-month-width-{{i}}"><span id="timelineMonthName{{i}}"></span></div>
            </div>
            {% endfor %}
        </div>

        <div class="timeline-day">

            <div class="timeline-today-line-pos" id="findNowPos">
                <div id="currentTime"></div>
            </div>

            <div class="timeline-wish">

                {% for wish in site.data.genshin.wish.characters %}
                {% assign i = forloop.index0 %}

                {% for characters in site.data.genshin.characters %}
                {% if characters[1].id == wish.wish5star %}
                <div class="card event-item event-item-{{i}} event-item-background-{{characters[1].ele}} hide">
                    <div class="card-image waves-effect waves-block waves-light" style="height: 100%">
                        <!-- Modal Trigger -->
                        <a class="modal-trigger" href="#modal{{i}}">
                            <div class="event-img responsive-img lazy"
                                 data-original="/assets/res/genshin-impact/characters/half/{{characters[1].id}}.png">
                            </div>
                        </a>
                        <span class="left-align timeline-character-text ele-text-{{characters[1].ele}}">{{characters[1].name}}</span>
                    </div>

                    <!-- Modal Structure -->
                    <div id="modal{{i}}" class="modal modal-fixed-footer radius10px">
                        <div class="modal-content auto-height hide-box-shadow hide-border">
                            <div class="card hide-box-shadow hide-border">
                                <div class="card-content valign-wrapper center-align">
                                    <h4 class="center-align"> {{wish.wishName}} -
                                        {{site.data.genshin.characters[wish.wish5star].name}}</h4>
                                </div>
                                <!--downcase转换小写 并用_替换空格 append其他标记-->
                                <!--replace
                                Replaces all occurrences of a string with a substring.-->
                                <div class="card-image waves-effect waves-block waves-light hoverable">
                                    <img alt="" loading="lazy"
                                         src="/assets/res/genshin-impact/events/{{ wish.name | downcase | replace: ' ', '_' | append: '_' | append: wish.image | append: '.jpg'  }}">
                                </div>
                                <div class="card-action">
                                    <a class="right ele-text-{{characters[1].ele}}" href="#" target="_blank">官方信息:TODO接入href</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                {% break %}
                {% endif %}
                {% endfor %}
                {% endfor %}
            </div>

            {% for i in (0..lenAllDays) %}
            <div class="timeline-wrapper left-day-{{i}} hide">
                <div class="timeline-index"><span id="timelineDay{{i}}"></span></div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!--语音暂不显示-->
<div class="hide">
    <div class="col s12">
        AUTOPLAY<p id="hutao-text"></p>
        <audio id="hutao-voice" controls="controls" autoplay="autoplay"></audio>
    </div>

    <div class="col s12">
        <details>
            <summary>展开所有语音</summary>
            <ul>
                {% for i in (0..6) %}
                <li><p id="hutao-text-{{i}}"></p>
                    <audio id="hutao-voice-{{i}}" controls="controls" preload="none"></audio>
                </li>
                {% endfor %}
            </ul>
        </details>
    </div>
</div>

<!--当前祈愿-->
<div class="col s12">

    <h2 id="noWishInfo"></h2>
    <div class="no-wish">

        <div class="row ">
            <h3 class="center">旅行者可以在活动祈愿中获得更多角色与武器，组建强大的队伍！</h3>
            <ul class="collapsible popout" data-collapsible="accordion">

                <li class="z-depth-2 hoverable radius5px">
                    <div class="collapsible-header">祈愿倒计时：<span id="deadline"></span></div>
                    <div class="collapsible-body hide"></div>
                </li>
                <li class="z-depth-2 hoverable radius5px">
                    <div class="collapsible-header">当前时间为：<span id="time_str"></span></div>
                    <div class="collapsible-body hide"></div>
                </li>
                <li class="z-depth-2 hoverable radius5px">
                    <div class="collapsible-header">当前祈愿周期为：
                        <span id="timeStartCurrentCharacter"></span> ~ <span id="timeEndCurrentCharacter"></span>
                    </div>
                    <div class="collapsible-body hide"></div>
                </li>
            </ul>
        </div>

        <div class="slider">
            <ul class="slides">
                {% for i in (0..3) %}
                <li>
                    <img id="showCurrentWishCharacter{{i}}" loading="lazy">
                    <div class="caption left-align">
                        <h5 class="current-wish-color-{{i}}" id="currentCharacter{{i}}"></h5>
                        <h4 class="light current-wish-color-{{i}}" id="currentWishText{{i}}"></h4>
                    </div>
                </li>
                {% endfor %}
            </ul>
        </div>

    </div>
</div>

<!--版本答案-->
<div class="row">
    <h2>版本答案 队伍推荐</h2>
    <ul class="collapsible" data-collapsible="accordion">
        {% for party in site.data.genshin.party-setup %}
        <li class="hoverable radius5px">
            <div class="collapsible-header">
                <span>{{party.name}}</span>
            </div>

            <div class="collapsible-body">
                <p>
                    {% for i in (0..party.party.size) %}
                    <!--跳过最大的 index从0起 包含了size-->
                    {% if i >= party.party.size %}
                    {% break %}
                    {% endif %}
                    <span>{{party.party[i]}}<span class="chip">{{party.constellation[i]}}</span></span>
                    {% endfor %}
                </p>
                <p>{{party.party}}
                    {% if party.advantage != nil %}<br>优势：{{party.advantage}} {% endif %}
                    {% if party.disadvantage != nil %} <br>缺陷：{{party.disadvantage}} {% endif %}
                </p>
            </div>
        </li>
        {% endfor %}
    </ul>
</div>

<!--即将发布-->
<div class="row">

    <h2>即将发布</h2>

    <span id="futureWishInfo"></span>
    <div class="future-wish">

        <div class="slider">
            <ul class="slides">
                {% assign pos = "right-align, left-align, center-align, left-align, center-align" | split: "," %}
                {% for i in (0..lenFuture) %}
                <li class="future-wish-bg-color-{{i}}">
                    <img id="futureWishBG{{i}}" loading="lazy">

                    <div class="caption {{pos[forloop.index0]}}">
                        <h4 class="light future-wish-color-{{i}}" id="futureWish{{i}}"></h4>
                        <h5 class="future-wish-color-{{i}}" id="futureWishText{{i}}"></h5>
                        <img class="z-depth-0 responsive-img hide" id="futureElements{{i}}"
                             loading="lazy">
                    </div>
                </li>
                {% endfor %}
            </ul>
        </div>

    </div>
</div>

<!--空行分割-->
<div class="col s12"> &nbsp;</div>

<h2>观月推荐</h2>

<div class="row">
    {% for artifacts in site.data.genshin.artifacts-collocation %}
    <div class="col s12 m6 l4 ">
        <div class="card ">
            <div class="card-image waves-effect waves-block waves-light hoverable">
                <img class="activator" src="/assets/res/genshin-impact/characters/half/{{artifacts[0]}}.png"
                     loading="lazy">
            </div>

            <div class="card-reveal">
                <span class="card-title">{{artifacts[1].name}}圣遗物</span>
                {% if artifacts[1].artifacts != "" %} 推荐：{{artifacts[1].artifacts}}<br>{% endif %}

                {% if artifacts[1].main.sands != nil or artifacts[1].main.goblet != nil
                or artifacts[1].main.circlet != nil %}
                主词条：沙漏【{{artifacts[1].main.sands}}】 杯子【{{artifacts[1].main.goblet}}】
                头【{{artifacts[1].main.circlet}}】<br>
                {% endif %}

                {% if artifacts[1].sub != "" %} 副词条：{{artifacts[1].sub}}<br>{% endif %}
                {% if artifacts[1].tips != nil %} TIPS：{{artifacts[1].tips}}<br>{% endif %}
            </div>

        </div>
    </div>
    {% endfor %}
</div>

<h2>原神——<a href="javascript:showAll()">全部角色</a></h2>
<div class="row center-align">
    {% assign eleName = "dendro,geo,electro,hydro,pyro,anemo,cryo" | split: "," %}
    {% for e in eleName %}
    <button class="waves-effect waves-light hoverable hide-border" id="{{e}}" type="submit">
        <img src="/assets/res/genshin-impact/elements/{{e}}.png" loading="lazy">
    </button>
    {% endfor %}
</div>

<div class="row">
    {% for e in eleName %}
    {% for characters in site.data.genshin.characters %}
    {% if characters[1].ele == e %}
    <div class="col s3 m2 l1  hide show-{{characters[1].ele}}">
        <a class="modal-trigger" href="#modal{{characters[1].id}}">
            <div class="card radius10px">
                <!--设置背景时发现高度为0 增加 padding-bottom 即可显示 上面时间轴在父级设置height100%也行-->
                <div class="card-image waves-effect waves-block waves-light hoverable character-avatar">
                    <img src="/assets/res/genshin-impact/characters/{{characters[1].id}}.png" loading="lazy">
                </div>
            </div>
        </a>
    </div>

    <!-- Modal Structure -->
    <div id="modal{{characters[1].id}}" class="modal modal-fixed-footer radius10px">
        <div class="modal-content auto-height hide-box-shadow hide-border">
            <div class="card hide-box-shadow hide-border">
                <div class="card-content">
                    <h4 class="center-align"> {{characters[1].prefix}} - {{characters[1].name}}</h4>
                </div>
                <div class="card-action valign-wrapper">
                    <span class="ele-text-{{characters[1].ele}}">{{characters[1].intro}}</span>
                </div>
                <div class="card-image waves-effect waves-block waves-light hoverable">
                    <img alt="" loading="lazy"
                         src="/assets/res/genshin-impact/characters/full/{{characters[1].id}}.png">
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    {% endfor %}
    {% endfor %}
</div>

<h2>原魔——全部怪物</h2>
<div class="row">
    {% for monsters in site.data.genshin.monsters %}
    <div class="col s3 m2 l1">
        <div class="card radius10px">
            <div class="card-image waves-effect waves-block waves-light hoverable monster-avatar">
                <img src="/assets/res/genshin-impact/monsters/{{monsters[0]}}.png" loading="lazy">
            </div>
        </div>
    </div>
    {% endfor %}
</div>


<div class="divider"></div>